var t={};t=class{scoreMax=0;constructor(t=[]){this.board=t?[...this._getBlankBoard()]:t,this.scoreCurrent=0,this.gameStatus="idle"}_getBlankBoard(){return Array.from({length:4},()=>Array.from({length:4},()=>0))}_initialize(){this.board=[...this._getBlankBoard()],this._genRandCells(),this._genRandCells()}_clearBoard(){this.board=this._getBlankBoard()}_genRandCells(){let t=this._generateRandomTile(this.board);t&&(this.board[t[0]][t[1]]=t[2])}_generateRandomTile(t){let e,r;do e=Math.floor(Math.random()*t.length),r=Math.floor(Math.random()*t[0].length);while(0!==t[e][r])let s=2;return 10>=Math.floor(100*Math.random()+1)&&(s=4),[e,r,s]}_checkGameStatus(){if(this.board.some(t=>t.some(t=>2048===t)))return this.gameStatus="win",!1;let t=this.board.reduce((t,e)=>t+e.filter(t=>0===t).length,0);return!1===this._anyMovesLeft()&&0===t?(this.gameStatus="lose",!1):(this.gameStatus="playing",!0)}_didTileMoved(t,e){for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length;s++)if(e[r][s]!==t[r][s])return!0;return!1}_anyMovesLeft(){return[this._combineTiles("ArrowLeft",this.board).score,this._combineTiles("ArrowRight",this.board).score,this._combineTiles("ArrowUp",this.board).score,this._combineTiles("ArrowDown",this.board).score].some(t=>0!==t)}moves(t){if("playing"===this.getStatus()){let e=this._arrayDeepCopy(this.board),r=this._combineTiles(t,this.board);this.board=this._arrayDeepCopy(r.board),this.scoreCurrent+=r.score,this._updateMaxScore(this.scoreCurrent),this._didTileMoved(e,this.board)&&this._genRandCells(),this._checkGameStatus()}}_shiftRight(t){let e=[...t];for(let t=0;t<e.length;t++){let r=e[t].filter(t=>t);e[t]=Array.from({length:e[t].length-r.length},()=>0).concat(r)}return e}_shiftLeft(t){let e=[...t];for(let t=0;t<e.length;t++){let r=e[t].filter(t=>t);e[t]=r.concat(Array.from({length:e[t].length-r.length},()=>0))}return e}_transpose(t){let e=[];for(let r=0;r<t.length;r++){let s=[];for(let e=0;e<t[0].length;e++)s.push(t[e][r]);e.push(s)}return e}_combineTiles(t,e){function r(){for(let t=0;t<s.length;t++)for(let e=0;e<s[t].length-1;e++){let r=s[t][e],i=s[t][e+1];r&&i&&r===i&&(s[t][e]=r+i,s[t][e+1]=0,e++,a=r+i)}}let s=this._arrayDeepCopy(e),a=0;switch(t){case"ArrowLeft":s=this._shiftLeft(s),r(),s=this._shiftLeft(s);break;case"ArrowRight":s=this._shiftRight(s),function(){for(let t=s.length-1;t>=0;t--)for(let e=s[t].length-1;e>=1;e--){let r=s[t][e],i=s[t][e-1];r&&i&&r===i&&(s[t][e]=r+i,s[t][e-1]=0,e--,a=r+i)}}(),s=this._shiftRight(s);break;case"ArrowUp":s=this._transpose(s),s=this._shiftLeft(s),r(),s=this._shiftLeft(s),s=this._transpose(s);break;case"ArrowDown":s=this._transpose(s),s=this._shiftRight(s),r(),s=this._shiftRight(s),s=this._transpose(s)}return{board:s,score:a}}getScore(){return this.scoreCurrent}getScoreMax(){return this.scoreMax}getStatus(){return this.gameStatus}getBoard(){return this.board}start(){this.gameStatus="playing",this._initialize()}restart(){this.scoreCurrent=0,this.gameStatus="idle",this._clearBoard()}_arrayDeepCopy(t){return"object"!=typeof t||null===t?t:t instanceof Date?new Date(t.getTime()):t instanceof Array?t.reduce((t,e,r)=>(t[r]=this._arrayDeepCopy(e),t),[]):t instanceof Object?Object.keys(t).reduce((e,r)=>(e[r]=this._arrayDeepCopy(t[r]),e),{}):void 0}_updateMaxScore(t){this.scoreMax<t&&(this.scoreMax=t)}};const e=document.querySelector(".game-field > tbody"),r=document.querySelector(".start"),s=document.querySelector(".curScore"),a=document.querySelector(".maxScore"),i=document.querySelector(".message-start"),o=document.querySelector(".message-win"),n=document.querySelector(".message-lose"),l=new t;function h(){let t=l.getBoard();for(let r=0;r<t.length;r++)for(let s=0;s<t[r].length;s++){let a=e.rows[r].cells[s],i=t[r][s];i?(a.textContent=i,a.classList="field-cell",a.classList.add(`field-cell--${i}`)):(a.textContent="",a.classList="field-cell")}switch(a.textContent=String(l.getScoreMax()),s.textContent=String(l.getScore()),"idle"===l.getStatus()?(r.className="button start",r.textContent="Start"):(r.className="button restart",r.textContent="Restart"),l.getStatus()){case"playing":[i,o,n].forEach(t=>t?.classList.contains("hidden")?"":t?.classList.add("hidden"));break;case"idle":i?.classList.remove("hidden");break;case"win":o?.classList.remove("hidden");break;case"lose":n?.classList.remove("hidden")}}document.addEventListener("keydown",t=>{"playing"===l.getStatus()&&l.moves(t.key),h()}),r?.addEventListener("click",t=>{"idle"===l.getStatus()?l.start():l.restart(),h()});
//# sourceMappingURL=index.46cdf737.js.map
