!function(){var t={};function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function r(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return e(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,void 0)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}t=function(){var t;function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e),(t="scoreMax")in this?Object.defineProperty(this,t,{value:0,enumerable:!0,configurable:!0,writable:!0}):this[t]=0,this.board=n?r(this._getBlankBoard()):n,this.scoreCurrent=0,this.gameStatus="idle"}return t=[{key:"_getBlankBoard",value:function(){return Array.from({length:4},function(){return Array.from({length:4},function(){return 0})})}},{key:"_initialize",value:function(){this.board=r(this._getBlankBoard()),this._genRandCells(),this._genRandCells()}},{key:"_clearBoard",value:function(){this.board=this._getBlankBoard()}},{key:"_genRandCells",value:function(){var t=this._generateRandomTile(this.board);t&&(this.board[t[0]][t[1]]=t[2])}},{key:"_generateRandomTile",value:function(t){do e=Math.floor(Math.random()*t.length),r=Math.floor(Math.random()*t[0].length);while(0!==t[e][r])var e,r,n=2;return 10>=Math.floor(100*Math.random()+1)&&(n=4),[e,r,n]}},{key:"_checkGameStatus",value:function(){if(this.board.some(function(t){return t.some(function(t){return 2048===t})}))return this.gameStatus="win",!1;var t=this.board.reduce(function(t,e){return t+e.filter(function(t){return 0===t}).length},0);return!1===this._anyMovesLeft()&&0===t?(this.gameStatus="lose",!1):(this.gameStatus="playing",!0)}},{key:"_didTileMoved",value:function(t,e){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)if(e[r][n]!==t[r][n])return!0;return!1}},{key:"_anyMovesLeft",value:function(){return[this._combineTiles("ArrowLeft",this.board).score,this._combineTiles("ArrowRight",this.board).score,this._combineTiles("ArrowUp",this.board).score,this._combineTiles("ArrowDown",this.board).score].some(function(t){return 0!==t})}},{key:"moves",value:function(t){if("playing"===this.getStatus()){var e=this._arrayDeepCopy(this.board),r=this._combineTiles(t,this.board);this.board=this._arrayDeepCopy(r.board),this.scoreCurrent+=r.score,this._updateMaxScore(this.scoreCurrent),this._didTileMoved(e,this.board)&&this._genRandCells(),this._checkGameStatus()}}},{key:"_shiftRight",value:function(t){for(var e=r(t),n=0;n<e.length;n++){var a=e[n].filter(function(t){return t});e[n]=Array.from({length:e[n].length-a.length},function(){return 0}).concat(a)}return e}},{key:"_shiftLeft",value:function(t){for(var e=r(t),n=0;n<e.length;n++){var a=e[n].filter(function(t){return t});e[n]=a.concat(Array.from({length:e[n].length-a.length},function(){return 0}))}return e}},{key:"_transpose",value:function(t){for(var e=[],r=0;r<t.length;r++){for(var n=[],a=0;a<t[0].length;a++)n.push(t[a][r]);e.push(n)}return e}},{key:"_combineTiles",value:function(t,e){function r(){for(var t=0;t<n.length;t++)for(var e=0;e<n[t].length-1;e++){var r=n[t][e],o=n[t][e+1];r&&o&&r===o&&(n[t][e]=r+o,n[t][e+1]=0,e++,a=r+o)}}var n=this._arrayDeepCopy(e),a=0;switch(t){case"ArrowLeft":n=this._shiftLeft(n),r(),n=this._shiftLeft(n);break;case"ArrowRight":n=this._shiftRight(n),function(){for(var t=n.length-1;t>=0;t--)for(var e=n[t].length-1;e>=1;e--){var r=n[t][e],o=n[t][e-1];r&&o&&r===o&&(n[t][e]=r+o,n[t][e-1]=0,e--,a=r+o)}}(),n=this._shiftRight(n);break;case"ArrowUp":n=this._transpose(n),n=this._shiftLeft(n),r(),n=this._shiftLeft(n),n=this._transpose(n);break;case"ArrowDown":n=this._transpose(n),n=this._shiftRight(n),r(),n=this._shiftRight(n),n=this._transpose(n)}return{board:n,score:a}}},{key:"getScore",value:function(){return this.scoreCurrent}},{key:"getScoreMax",value:function(){return this.scoreMax}},{key:"getStatus",value:function(){return this.gameStatus}},{key:"getBoard",value:function(){return this.board}},{key:"start",value:function(){this.gameStatus="playing",this._initialize()}},{key:"restart",value:function(){this.scoreCurrent=0,this.gameStatus="idle",this._clearBoard()}},{key:"_arrayDeepCopy",value:function(t){var e=this;return"object"!=typeof t||null===t?t:t instanceof Date?new Date(t.getTime()):t instanceof Array?t.reduce(function(t,r,n){return t[n]=e._arrayDeepCopy(r),t},[]):t instanceof Object?Object.keys(t).reduce(function(r,n){return r[n]=e._arrayDeepCopy(t[n]),r},{}):void 0}},{key:"_updateMaxScore",value:function(t){this.scoreMax<t&&(this.scoreMax=t)}}],function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,t),e}();var n=document.querySelector(".game-field > tbody"),a=document.querySelector(".start"),o=document.querySelector(".curScore"),i=document.querySelector(".maxScore"),s=document.querySelector(".message-start"),u=document.querySelector(".message-win"),l=document.querySelector(".message-lose"),c=new t;function h(){for(var t=c.getBoard(),e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++){var h=n.rows[e].cells[r],f=t[e][r];f?(h.textContent=f,h.classList="field-cell",h.classList.add("field-cell--".concat(f))):(h.textContent="",h.classList="field-cell")}switch(i.textContent=String(c.getScoreMax()),o.textContent=String(c.getScore()),"idle"===c.getStatus()?(a.className="button start",a.textContent="Start"):(a.className="button restart",a.textContent="Restart"),c.getStatus()){case"playing":[s,u,l].forEach(function(t){return(null==t?void 0:t.classList.contains("hidden"))?"":null==t?void 0:t.classList.add("hidden")});break;case"idle":null==s||s.classList.remove("hidden");break;case"win":null==u||u.classList.remove("hidden");break;case"lose":null==l||l.classList.remove("hidden")}}document.addEventListener("keydown",function(t){"playing"===c.getStatus()&&c.moves(t.key),h()}),null==a||a.addEventListener("click",function(t){"idle"===c.getStatus()?c.start():c.restart(),h()})}();
//# sourceMappingURL=index.8ff22563.js.map
